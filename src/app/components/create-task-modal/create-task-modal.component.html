<div class="popup-overlay" (click)="close.emit()">
  <div class="popup-content card" (click)="$event.stopPropagation()">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="mb-0">Crear Nueva Tarea</h5>
      <button type="button" class="btn-close" (click)="close.emit()"></button>
    </div>
    <div class="card-body">
      <form [formGroup]="taskForm" (ngSubmit)="onSubmit()">
        <div class="mb-3">
          <label for="title" class="form-label">Título de la Tarea</label>
          <input type="text" id="title" formControlName="title" class="form-control">
        </div>
        <div class="mb-3">
          <label for="description" class="form-label">Descripción</label>
          <textarea id="description" formControlName="description" class="form-control" rows="2"></textarea>
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="startDate" class="form-label">Fecha de Inicio</label>
            <input type="date" id="startDate" formControlName="startDate" class="form-control" 
                   [min]="projectStartDate" [max]="projectEndDate">
          </div>
          <div class="col-md-6 mb-3">
            <label for="endDate" class="form-label">Fecha de Fin</label>
            <input type="date" id="endDate" formControlName="endDate" class="form-control"
                   [min]="projectStartDate" [max]="projectEndDate">
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="assignedUserId" class="form-label">Asignar a</label>
            <select id="assignedUserId" formControlName="assignedUserId" class="form-select">
              <option [ngValue]="null">Sin asignar</option>
              <option *ngFor="let user of users$ | async" [value]="user.id">{{ user.username }}</option>
            </select>
          </div>
          <div class="col-md-6 mb-3">
            <label for="priority" class="form-label">Prioridad</label>
            <select id="priority" formControlName="priority" class="form-select">
              <option value="BAJA">Baja</option>
              <option value="MEDIA">Media</option>
              <option value="ALTA">Alta</option>
            </select>
          </div>
        </div>
        <div class="mb-3">
            <label for="dependencyId" class="form-label">Depende de (opcional)</label>
            <select id="dependencyId" formControlName="dependencyId" class="form-select">
              <option [ngValue]="null">Ninguna</option>
              <option *ngFor="let task of existingTasks" [value]="task.id">{{ task.title }}</option>
            </select>
        </div>

        <div *ngIf="errorMessage" class="alert alert-danger mt-3">
          {{ errorMessage }}
        </div>

        <div class="d-flex justify-content-end mt-3">
          <button type="button" class="btn btn-secondary me-2" (click)="close.emit()">Cancelar</button>
          <button type="submit" class="btn btn-primary" [disabled]="taskForm.invalid">Crear Tarea</button>
        </div>
      </form>
    </div>
  </div>
</div>